apiVersion: contour.heptio.com/v1beta1
kind: IngressRoute
metadata:
  name: {{ template "node.fullname" . }}-root-ingress
  namespace: default
spec:
  virtualhost:
    fqdn: {{ .Values.fqdn }}
    tls:
      secretName: {{ .Values.tls }}
  routes:
    - match: /
      timeoutPolicy:
        request: {{ .Values.TimeOutPolicy.request }}
      retryPolicy:
        count: {{ .Values.RetryPolicy.count }}
        perTryTimeout: {{ .Values.RetryPolicy.perTryTimeout }}
      delegate:
        name: {{ template "node.fullname" . }}-ingress
        namespace: {{ .Values.namespace }}

---

apiVersion: contour.heptio.com/v1beta1
kind: IngressRoute
metadata:
  name: {{ template "node.fullname" . }}-ingress

spec:
  routes:
    - match: /
      services:
        - name: {{ template "node.fullname" . }}
          port: {{ .Values.service.port }}
          healthCheck:
            path: {{ .Values.HealthCheck.path }}
            intervalSeconds: {{ .Values.HealthCheck.intervalSeconds }}
            timeoutSeconds: {{ .Values.HealthCheck.timeoutSeconds }}
            unhealthyThresholdCount: {{ .Values.HealthCheck.unhealthyThresholdCount }}
            healthyThresholdCount: {{ .Values.HealthCheck.healthyThresholdCount }}

